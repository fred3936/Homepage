<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Assignment_7</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Dongcheng's Homepage</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Assignment.html">Assignments</a>
    </li>
    <li>
      <a href="Assignment_4.html">Assignment 4</a>
    </li>
    <li>
      <a href="Assignment_5.html">Assignment 5</a>
    </li>
    <li>
      <a href="Assignment_6.html">Assignment 6</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Lab.html">Labs</a>
    </li>
    <li>
      <a href="Lab_5.html">Lab 5</a>
    </li>
    <li>
      <a href="Lab_6.html">Lab 6</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Assignment_7</h1>

</div>


<p>Assignment 7: Relational data plus revisiting data wrangling and visualization ================</p>
<div id="instructions-please-read-through-this-before-you-begin" class="section level2">
<h2>Instructions: Please read through this before you begin</h2>
<ul>
<li><p>This homework is due by <strong>10pm on Thursday 03/17/20</strong>. Please upload it using your personal GitHub repository for this class.</p></li>
<li><p>Please name your R markdown file <code>assignment_7.Rmd</code> and the knitted markdown file <code>assignment_7.md</code>.</p></li>
<li><p>For this assignment, please <strong>reproduce this markdown file</strong> using R markdown. This includes the followings:</p>
<ul>
<li><p><strong>Reproduce this markdown template</strong>, except for this list of instructions which you <strong>don’t</strong> have to include. Pay attention to all the formating in this file, including bullet points, bolded characters, inserted code chunks, headings, text colors, blank lines, etc.</p></li>
<li><p>Have all your code embedded within the R markdown file, and show <strong>BOTH your code and plots</strong> in the knitted markdown file.</p></li>
<li><p>Use R Markdown functionalities to <strong>hide messages and warnings when needed</strong>. (Suggestion: messages and warnings can often be informative and important, so please examine them carefully and only turn them off when you finish the exercise).</p></li>
</ul></li>
<li><p>To start, first load all the required packages with the following code. Install them if they are not installed yet.</p></li>
</ul>
<pre class="r"><code>library(tidyverse)
library(knitr)
library(dslabs)</code></pre>
<p><br></p>
</div>
<div id="excercise-2016-election-result-and-polling" class="section level2">
<h2>Excercise: 2016 election result and polling</h2>
<p>For this exercise, we will explore the result of the 2016 US presidential election as well as the polling data. We will use the following three datasets in the <code>dslabs</code> package, and use <code>join</code> function to connect them together. As a reminder, you can use <code>?</code> to learn more about these datasets.</p>
<ul>
<li><p><code>results_us_election_2016</code>: Election results (popular vote) and electoral college votes from the 2016 presidential election.</p></li>
<li><p><code>polls_us_election_2016</code>: Poll results from the 2016 presidential elections.</p></li>
<li><p><code>murders</code>: Gun murder data from FBI reports. It also contains the population of each state.</p></li>
</ul>
<p>We will also use <a href="https://raw.githubusercontent.com/kshaffer/election2016/master/2016ElectionResultsByState.csv">this dataset</a> to get the exact numbers of votes for question 3.</p>
<p><br></p>
<div id="question-1.-what-is-the-relationship-between-the-population-size-and-the-number-of-electoral-votes-each-state-has" class="section level3">
<h3>Question 1. What is the relationship between the population size and the number of electoral votes each state has?</h3>
<p><strong>1a.</strong> Use a <code>join</code> function to combine the <code>murders</code> dataset, which contains information on population size, and the <code>results_us_election_2016</code> dataset, which contains information on the number of electoral votes. Name this new dataset <code>q_1a</code>, and show its first 6 rows.</p>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="left">abb</th>
<th align="left">region</th>
<th align="right">population</th>
<th align="right">total</th>
<th align="right">electoral_votes</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="left">AL</td>
<td align="left">South</td>
<td align="right">4779736</td>
<td align="right">135</td>
<td align="right">9</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="left">AK</td>
<td align="left">West</td>
<td align="right">710231</td>
<td align="right">19</td>
<td align="right">3</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="left">AZ</td>
<td align="left">West</td>
<td align="right">6392017</td>
<td align="right">232</td>
<td align="right">11</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="left">AR</td>
<td align="left">South</td>
<td align="right">2915918</td>
<td align="right">93</td>
<td align="right">6</td>
<td align="right">33.7</td>
<td align="right">60.6</td>
<td align="right">5.8</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="left">CA</td>
<td align="left">West</td>
<td align="right">37253956</td>
<td align="right">1257</td>
<td align="right">55</td>
<td align="right">61.7</td>
<td align="right">31.6</td>
<td align="right">6.7</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="left">CO</td>
<td align="left">West</td>
<td align="right">5029196</td>
<td align="right">65</td>
<td align="right">9</td>
<td align="right">48.2</td>
<td align="right">43.3</td>
<td align="right">8.6</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_1a &lt;-
  murders %&gt;%
  inner_join(results_us_election_2016, by = c(state=&quot;state&quot;))
kable(head(q_1a, n = 6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="left">abb</th>
<th align="left">region</th>
<th align="right">population</th>
<th align="right">total</th>
<th align="right">electoral_votes</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="left">AL</td>
<td align="left">South</td>
<td align="right">4779736</td>
<td align="right">135</td>
<td align="right">9</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="left">AK</td>
<td align="left">West</td>
<td align="right">710231</td>
<td align="right">19</td>
<td align="right">3</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="left">AZ</td>
<td align="left">West</td>
<td align="right">6392017</td>
<td align="right">232</td>
<td align="right">11</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="left">AR</td>
<td align="left">South</td>
<td align="right">2915918</td>
<td align="right">93</td>
<td align="right">6</td>
<td align="right">33.7</td>
<td align="right">60.6</td>
<td align="right">5.8</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="left">CA</td>
<td align="left">West</td>
<td align="right">37253956</td>
<td align="right">1257</td>
<td align="right">55</td>
<td align="right">61.7</td>
<td align="right">31.6</td>
<td align="right">6.7</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="left">CO</td>
<td align="left">West</td>
<td align="right">5029196</td>
<td align="right">65</td>
<td align="right">9</td>
<td align="right">48.2</td>
<td align="right">43.3</td>
<td align="right">8.6</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>1b.</strong> Add a new variable in the <code>q_1a</code> dataset to indicate which candidate won in each state, and remove the columns <code>abb</code>, <code>region</code>, and <code>total</code>. Name this new dataset <code>q_1b</code>, and show its first 6 rows.</p>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">population</th>
<th align="right">electoral_votes</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
<th align="left">winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">4779736</td>
<td align="right">9</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">710231</td>
<td align="right">3</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">6392017</td>
<td align="right">11</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="right">2915918</td>
<td align="right">6</td>
<td align="right">33.7</td>
<td align="right">60.6</td>
<td align="right">5.8</td>
<td align="left">trump</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="right">37253956</td>
<td align="right">55</td>
<td align="right">61.7</td>
<td align="right">31.6</td>
<td align="right">6.7</td>
<td align="left">clinton</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="right">5029196</td>
<td align="right">9</td>
<td align="right">48.2</td>
<td align="right">43.3</td>
<td align="right">8.6</td>
<td align="left">clinton</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_1b &lt;- q_1a %&gt;%
  mutate(winner = if_else(trump &gt; clinton, &quot;trump&quot;, &quot;clinton&quot;))%&gt;%
  select(-c(abb, region, total))

kable(head(q_1b, n = 6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">population</th>
<th align="right">electoral_votes</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
<th align="left">winner</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">4779736</td>
<td align="right">9</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">710231</td>
<td align="right">3</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">6392017</td>
<td align="right">11</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
</tr>
<tr class="even">
<td align="left">Arkansas</td>
<td align="right">2915918</td>
<td align="right">6</td>
<td align="right">33.7</td>
<td align="right">60.6</td>
<td align="right">5.8</td>
<td align="left">trump</td>
</tr>
<tr class="odd">
<td align="left">California</td>
<td align="right">37253956</td>
<td align="right">55</td>
<td align="right">61.7</td>
<td align="right">31.6</td>
<td align="right">6.7</td>
<td align="left">clinton</td>
</tr>
<tr class="even">
<td align="left">Colorado</td>
<td align="right">5029196</td>
<td align="right">9</td>
<td align="right">48.2</td>
<td align="right">43.3</td>
<td align="right">8.6</td>
<td align="left">clinton</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>1c.</strong> Using the <code>q_1b</code> dataset, plot the relationship between population size and number of electoral votes. Use color to indicate who won the state. Fit a straight line to the data, set its color to black, size to 0.1, and turn off its confidence interval.</p>
<pre class="r"><code>q_1b %&gt;%
  ggplot(aes(x=population, y=electoral_votes)) +
  geom_point(aes(color=winner))+
  stat_smooth(method=&quot;lm&quot;, se=FALSE,color=&quot;black&quot;,size=0.1)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Assignment_7_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="question-2.-would-the-election-result-be-any-different-if-the-number-of-electoral-votes-is-exactly-proportional-to-a-states-population-size" class="section level3">
<h3>Question 2. Would the election result be any different if the number of electoral votes is exactly proportional to a state’s population size?</h3>
<p><strong>2a.</strong> First, convert the <code>q_1b</code> dataset to longer format such that the <code>population</code> and <code>electoral_votes</code> columns are turned into rows as shown below. Name this new dataset <code>q_2a</code>, and show its first 6 rows.</p>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
<th align="left">winner</th>
<th align="left">metric</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">4779736</td>
</tr>
<tr class="even">
<td align="left">Alabama</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">Alaska</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">710231</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">6392017</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_2a &lt;- q_1b %&gt;%
  pivot_longer(c(2:3), names_to = &quot;metric&quot;, values_to = &quot;value&quot;)

kable(head(q_2a, n = 6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">clinton</th>
<th align="right">trump</th>
<th align="right">others</th>
<th align="left">winner</th>
<th align="left">metric</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">4779736</td>
</tr>
<tr class="even">
<td align="left">Alabama</td>
<td align="right">34.4</td>
<td align="right">62.1</td>
<td align="right">3.6</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">Alaska</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">710231</td>
</tr>
<tr class="even">
<td align="left">Alaska</td>
<td align="right">36.6</td>
<td align="right">51.3</td>
<td align="right">12.2</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Arizona</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
<td align="left">population</td>
<td align="right">6392017</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">45.1</td>
<td align="right">48.7</td>
<td align="right">6.2</td>
<td align="left">trump</td>
<td align="left">electoral_votes</td>
<td align="right">11</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>2b.</strong> Then, sum up the number of electoral votes and population size across all states for each candidate. Name this new dataset <code>q_2b</code>, and print it as shown below.</p>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">electoral_votes</td>
<td align="left">clinton</td>
<td align="right">233</td>
</tr>
<tr class="even">
<td align="left">electoral_votes</td>
<td align="left">trump</td>
<td align="right">305</td>
</tr>
<tr class="odd">
<td align="left">population</td>
<td align="left">clinton</td>
<td align="right">134982448</td>
</tr>
<tr class="even">
<td align="left">population</td>
<td align="left">trump</td>
<td align="right">174881780</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_2b &lt;- q_2a %&gt;%
  group_by(metric, winner)%&gt;%
  summarise(value = sum(value))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;metric&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>kable(head(q_2b, n = 6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">electoral_votes</td>
<td align="left">clinton</td>
<td align="right">233</td>
</tr>
<tr class="even">
<td align="left">electoral_votes</td>
<td align="left">trump</td>
<td align="right">305</td>
</tr>
<tr class="odd">
<td align="left">population</td>
<td align="left">clinton</td>
<td align="right">134982448</td>
</tr>
<tr class="even">
<td align="left">population</td>
<td align="left">trump</td>
<td align="right">174881780</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>2c.</strong> Use the <code>q_2b</code> dataset to contruct a bar plot to show the final electoral vote share under the scenarios of <strong>1)</strong> each state has the number of electoral votes that it currently has, and <strong>2)</strong> each state has the number of electoral votes that is exactly proportional to its population size. Here, assume that for each state, the winner will take all its electoral votes.</p>
<p><br></p>
<p><em>Hint: <code>geom_col(position = "fill")</code> might be helpful.</em></p>
<pre class="r"><code>q_2b %&gt;%
  ggplot()+
  geom_col(aes(x=metric, y = value, fill = winner), position = &quot;fill&quot;)</code></pre>
<p><img src="Assignment_7_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="question-3.-what-if-the-election-was-determined-by-popular-votes" class="section level3">
<h3>Question 3. What if the election was determined by popular votes?</h3>
<p><strong>3a.</strong> First, from <a href="https://raw.githubusercontent.com/kshaffer/election2016/master/2016ElectionResultsByState.csv">this dataset on GitHub</a>, calculate the number of popular votes each candidate received as shown below. Name this new dataset <code>q_3a</code>, and print it. <br></p>
<p><em>Note: all candidates other than Clinton and Trump are included in <code>others</code> as shown below.</em></p>
<p><em>Hint: <code>pivot_longer()</code> may be useful in here.</em></p>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">clinton</td>
<td align="right">65125640</td>
</tr>
<tr class="even">
<td align="left">popular_votes</td>
<td align="left">trump</td>
<td align="right">62616675</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">others</td>
<td align="right">7054974</td>
</tr>
</tbody>
</table>
<pre class="r"><code>mutate_colsum &lt;- function(.data, col_name = &quot;sum&quot;, ...){
  tmp &lt;- select_at(.data, vars(...))
  .data[[col_name]] &lt;- rowSums(tmp)
  .data
}
q_3a &lt;- read_csv(file=&#39;https://raw.githubusercontent.com/kshaffer/election2016/master/2016ElectionResultsByState.csv&#39;)%&gt;%
  mutate_colsum(&quot;others&quot;, johnsonVotes:othersVotes)%&gt;% 
  pivot_longer(c(3,5,12), names_to = &quot;winner&quot;, values_to = &quot;value&quot;)%&gt;%
  mutate(metric = &quot;popular_votes&quot;) %&gt;%
  group_by(metric, winner)%&gt;%
  summarise(value = sum(value))%&gt;%
  arrange(desc(value))</code></pre>
<pre><code>## Rows: 51 Columns: 11
## -- Column specification --------------------------------------------------------
## Delimiter: &quot;,&quot;
## chr (2): state, postal
## dbl (9): clintonVotes, clintonElectors, trumpVotes, trumpElectors, johnsonVo...
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## `summarise()` has grouped output by &#39;metric&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>q_3a$winner &lt;- replace(q_3a$winner, q_3a$winner == &quot;clintonVotes&quot;, &quot;clinton&quot;)
q_3a$winner &lt;- replace(q_3a$winner, q_3a$winner == &quot;trumpVotes&quot;, &quot;trump&quot;)
kable(head(q_3a, n = 6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">clinton</td>
<td align="right">65125640</td>
</tr>
<tr class="even">
<td align="left">popular_votes</td>
<td align="left">trump</td>
<td align="right">62616675</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">others</td>
<td align="right">7054974</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>3b.</strong> Combine the <code>q_2b</code> dataset with the <code>q_3a</code> dataset. Call this new dataset <code>q_3b</code>, and print it as shown below.</p>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">electoral_votes</td>
<td align="left">clinton</td>
<td align="right">233</td>
</tr>
<tr class="even">
<td align="left">electoral_votes</td>
<td align="left">trump</td>
<td align="right">305</td>
</tr>
<tr class="odd">
<td align="left">population</td>
<td align="left">clinton</td>
<td align="right">134982448</td>
</tr>
<tr class="even">
<td align="left">population</td>
<td align="left">trump</td>
<td align="right">174881780</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">clinton</td>
<td align="right">65125640</td>
</tr>
<tr class="even">
<td align="left">popular_votes</td>
<td align="left">trump</td>
<td align="right">62616675</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">others</td>
<td align="right">7054974</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_3b&lt;-rbind(q_2b,q_3a)
q_3b %&gt;%
  kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="left">winner</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">electoral_votes</td>
<td align="left">clinton</td>
<td align="right">233</td>
</tr>
<tr class="even">
<td align="left">electoral_votes</td>
<td align="left">trump</td>
<td align="right">305</td>
</tr>
<tr class="odd">
<td align="left">population</td>
<td align="left">clinton</td>
<td align="right">134982448</td>
</tr>
<tr class="even">
<td align="left">population</td>
<td align="left">trump</td>
<td align="right">174881780</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">clinton</td>
<td align="right">65125640</td>
</tr>
<tr class="even">
<td align="left">popular_votes</td>
<td align="left">trump</td>
<td align="right">62616675</td>
</tr>
<tr class="odd">
<td align="left">popular_votes</td>
<td align="left">others</td>
<td align="right">7054974</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>3c.</strong> Lastly, use the <code>q_3b</code> dataset to contruct a bar plot to show the final vote share under the scenarios of <strong>1)</strong> each state has the number of electoral votes that it currently has, <strong>2)</strong> each state has the number of electoral votes that is exactly proportional to its population size, and <strong>3)</strong> the election result is determined by the popular vote.</p>
<pre class="r"><code>q_3b %&gt;%
  ggplot()+
  geom_col(aes(x=metric, y = value, fill = winner), position = &quot;fill&quot;)</code></pre>
<p><img src="Assignment_7_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><br> <br></p>
</div>
<div id="question-4.-the-election-result-in-2016-came-as-a-huge-surprise-to-many-people-especially-given-that-most-polls-predicted-clinton-would-win-before-the-election.-where-did-the-polls-get-wrong" class="section level3">
<h3>Question 4. The election result in 2016 came as a huge surprise to many people, especially given that most polls predicted Clinton would win before the election. Where did the polls get wrong?</h3>
<p><strong>4a.</strong> The polling data is stored in the data frame <code>polls_us_election_2016</code>. For the sake of simplicity, we will only look at the data from a single poll for each state. Subset the polling data to include only the results from the pollster <code>Ipsos</code>. Exclude national polls, and for each state, select the polling result with the <code>enddate</code> closest to the election day (i.e. those with the lastest end date). Keep only the columns <code>state</code>, <code>adjpoll_clinton</code>, and <code>adjpoll_trump</code>. Save this new dataset as <code>q_4a</code>, and show its first 6 rows.</p>
<p><br></p>
<p><em>Note: You should have 47 rows in <code>q_4a</code> because only 47 states were polled at least once by Ipsos. You don’t need to worry about the 3 missing states and DC.</em></p>
<p><em>Hint: <code>group_by()</code> and <code>slice_max()</code> can be useful for this question. Check out the help file for <code>slice_max()</code> for more info.</em></p>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">adjpoll_clinton</th>
<th align="right">adjpoll_trump</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">37.54023</td>
<td align="right">53.69718</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">41.35774</td>
<td align="right">46.17779</td>
</tr>
<tr class="odd">
<td align="left">Arkansas</td>
<td align="right">37.15339</td>
<td align="right">53.28384</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">58.33806</td>
<td align="right">31.00473</td>
</tr>
<tr class="odd">
<td align="left">Colorado</td>
<td align="right">46.00764</td>
<td align="right">40.73571</td>
</tr>
<tr class="even">
<td align="left">Connecticut</td>
<td align="right">48.81810</td>
<td align="right">38.87069</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_4a &lt;- polls_us_election_2016 %&gt;%
  filter(pollster==&quot;Ipsos&quot;)%&gt;%
  group_by(state)%&gt;%
  slice_max(order_by = enddate,n=1)%&gt;%
  select(c(&quot;state&quot;,&quot;adjpoll_clinton&quot;,&quot;adjpoll_trump&quot;))

kable(head(q_4a,n=6))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">adjpoll_clinton</th>
<th align="right">adjpoll_trump</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">37.54023</td>
<td align="right">53.69718</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">41.35774</td>
<td align="right">46.17779</td>
</tr>
<tr class="odd">
<td align="left">Arkansas</td>
<td align="right">37.15339</td>
<td align="right">53.28384</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">58.33806</td>
<td align="right">31.00473</td>
</tr>
<tr class="odd">
<td align="left">Colorado</td>
<td align="right">46.00764</td>
<td align="right">40.73571</td>
</tr>
<tr class="even">
<td align="left">Connecticut</td>
<td align="right">48.81810</td>
<td align="right">38.87069</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>4b.</strong> Combine the <code>q_4a</code> dataset with the <code>q_1b</code> dataset with a <code>join</code> function. The resulting dataset should only have 47 rows. Create the following new variables in this joined dataset.</p>
<ul>
<li><code>polling_margin</code>: difference between <code>adjpoll_clinton</code> and <code>adjpoll_trump</code></li>
<li><code>actual_margin</code>: difference between <code>clinton</code> and <code>trump</code></li>
<li><code>polling_error</code>: difference between <code>polling_margin</code> and <code>actual_margin</code></li>
<li><code>predicted_winner</code>: predicted winner based on <code>adjpoll_clinton</code> and <code>adjpoll_trump</code></li>
<li><code>result = ifelse(winner == predicted_winner, "correct prediction", str_c("unexpected ", winner, " win"))</code></li>
</ul>
<p>Keep only the columns <code>state</code>, <code>polling_error</code>, <code>result</code>, <code>electoral_votes</code>. Name the new dataset <code>q_4b</code> and show its first 6 rows.</p>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">polling_error</th>
<th align="left">result</th>
<th align="right">electoral_votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">11.54305</td>
<td align="left">correct prediction</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">-1.22005</td>
<td align="left">correct prediction</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Arkansas</td>
<td align="right">10.76955</td>
<td align="left">correct prediction</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">-2.76667</td>
<td align="left">correct prediction</td>
<td align="right">55</td>
</tr>
<tr class="odd">
<td align="left">Colorado</td>
<td align="right">0.37193</td>
<td align="left">correct prediction</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Connecticut</td>
<td align="right">-3.75259</td>
<td align="left">correct prediction</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<pre class="r"><code>q_4b &lt;- q_4a %&gt;%
 left_join(q_1b, by = &quot;state&quot;) %&gt;%
 mutate(polling_margin = adjpoll_clinton - adjpoll_trump,
        actual_margin = clinton - trump,
        polling_error = polling_margin - actual_margin,
        predicted_winner = ifelse(adjpoll_clinton &gt; adjpoll_trump, &quot;clinton&quot;,&quot;trump&quot;),
        result = ifelse(winner == predicted_winner, &quot;correct prediction&quot;, str_c(&quot;unexpected &quot;, winner, &quot; win&quot;))) %&gt;%
 select(&quot;state&quot;,&quot;polling_error&quot;,&quot;result&quot;,&quot;electoral_votes&quot;)
q_4b %&gt;%
 head(6) %&gt;%
 kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">state</th>
<th align="right">polling_error</th>
<th align="left">result</th>
<th align="right">electoral_votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Alabama</td>
<td align="right">11.54305</td>
<td align="left">correct prediction</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Arizona</td>
<td align="right">-1.22005</td>
<td align="left">correct prediction</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Arkansas</td>
<td align="right">10.76955</td>
<td align="left">correct prediction</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">California</td>
<td align="right">-2.76667</td>
<td align="left">correct prediction</td>
<td align="right">55</td>
</tr>
<tr class="odd">
<td align="left">Colorado</td>
<td align="right">0.37193</td>
<td align="left">correct prediction</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Connecticut</td>
<td align="right">-3.75259</td>
<td align="left">correct prediction</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p><br> <br></p>
<p><strong>4c.</strong> Generate the following plot with the <code>q_4b</code> dataset. Use chunk options to adjust the dimensions of the plot to make it longer than the default dimension. Based on this plot, where did the polls get wrong in the 2016 election?</p>
<pre class="r"><code>q_4b%&gt;%
  ggplot(aes(x=polling_error, y=state, color=result, size=electoral_votes))+
geom_point()</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="Assignment_7_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p><br> <br></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
